<mxfile host="app.diagrams.net" modified="2025-12-05T00:00:00.000Z" agent="AI Agent" version="24.0.0">
  <diagram name="PT-005 Architecture" id="pt005-architecture">
    <mxGraphModel dx="2400" dy="1800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="1800" background="#FFFFFF">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="PT-005: Retrieval-Augmented Generation (Self-Reflective RAG) - Architecture Overview" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontFamily=Helvetica;fontColor=#003087;" vertex="1" parent="1">
          <mxGeometry x="400" y="40" width="1600" height="60" as="geometry" />
        </mxCell>

        <!-- Pattern Boundary Container -->
        <mxCell id="pattern-boundary" value="RAG Pattern Boundary" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#003087;strokeWidth=3;dashed=1;dashPattern=8 8;verticalAlign=top;align=left;spacingLeft=15;spacingTop=10;fontSize=16;fontStyle=1;fontFamily=Helvetica;fontColor=#003087;" vertex="1" parent="1">
          <mxGeometry x="80" y="140" width="2240" height="1440" as="geometry" />
        </mxCell>

        <!-- User Query Input -->
        <mxCell id="user-query" value="User Query" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6699CC;strokeColor=#003087;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="120" y="240" width="160" height="80" as="geometry" />
        </mxCell>

        <!-- Query Intent Analyzer (AB-053) -->
        <mxCell id="query-intent" value="Query Intent Analyzer&#xa;(AB-053)&#xa;&#xa;Determine if retrieval&#xa;is needed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#003087;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="360" y="220" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Query Rewriting Engine (AB-059) - Optional -->
        <mxCell id="query-rewrite" value="Query Rewriting Engine&#xa;(AB-059)&#xa;&#xa;Reformulate complex&#xa;queries" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF6B35;strokeColor=#333333;strokeWidth=2;fontSize=13;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="360" y="400" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Hybrid Search Engine (AB-054) -->
        <mxCell id="hybrid-search" value="Hybrid Search Engine&#xa;(AB-054)&#xa;&#xa;Dense + Sparse Retrieval" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#003087;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="640" y="400" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Vector Database (AB-051) -->
        <mxCell id="vector-db" value="Vector Database&#xa;(AB-051)&#xa;&#xa;Document Embeddings&#xa;Semantic Search" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#00A651;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="640" y="600" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- Document Store -->
        <mxCell id="doc-store" value="Document Store&#xa;&#xa;Enterprise Documents&#xa;Knowledge Base&#xa;Policies &amp; Procedures" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#666666;strokeColor=#333333;strokeWidth=2;fontSize=13;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="640" y="800" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- Embedding Model (AB-052) -->
        <mxCell id="embedding-model" value="Embedding Model&#xa;(AB-052)&#xa;&#xa;Text → Vector&#xa;Conversion" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#50E6FF;strokeColor=#333333;strokeWidth=2;fontSize=13;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="920" y="600" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- Reranking Engine (AB-055) -->
        <mxCell id="reranking" value="Reranking Engine&#xa;(AB-055)&#xa;&#xa;Re-score Documents&#xa;Top-K → Top-N" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#003087;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="920" y="400" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- LLM Generator (AB-050) -->
        <mxCell id="llm-generator" value="Large Language Model&#xa;(AB-050)&#xa;&#xa;Query + Context → Response&#xa;Citation Generation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#003087;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1200" y="400" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- Self-Critique Engine (AB-056) -->
        <mxCell id="self-critique" value="Self-Critique Engine&#xa;(AB-056)&#xa;&#xa;Quality Evaluation&#xa;Hallucination Detection&#xa;Retry Logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF6B35;strokeColor=#333333;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1520" y="380" width="220" height="160" as="geometry" />
        </mxCell>

        <!-- Citation Generator (AB-058) -->
        <mxCell id="citation-gen" value="Citation Generator&#xa;(AB-058)&#xa;&#xa;Source Attribution" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#50E6FF;strokeColor=#333333;strokeWidth=2;fontSize=13;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1240" y="600" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Response Output -->
        <mxCell id="response-output" value="Response with&#xa;Citations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#00A651;strokeColor=#003087;strokeWidth=2;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1840" y="420" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Document Processing Pipeline (AB-057) -->
        <mxCell id="doc-processing" value="Document Processing Pipeline&#xa;(AB-057)&#xa;&#xa;Extract → Chunk → Embed → Index" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#50E6FF;strokeColor=#333333;strokeWidth=2;fontSize=13;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="320" y="820" width="240" height="100" as="geometry" />
        </mxCell>

        <!-- Cross-Cutting Components Section -->
        <mxCell id="cross-cutting-container" value="Cross-Cutting ABBs" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;strokeWidth=2;verticalAlign=top;align=left;spacingLeft=15;spacingTop=10;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="120" y="1020" width="2160" height="120" as="geometry" />
        </mxCell>

        <!-- AI Governance Platform -->
        <mxCell id="governance" value="AI Governance Platform&#xa;(AB-060)&#xa;Compliance, Audit Trail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#666666;strokeColor=#333333;strokeWidth=2;fontSize=12;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="160" y="1060" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Security & Identity -->
        <mxCell id="security" value="Security &amp; Identity&#xa;(AB-112)&#xa;Authentication, Authorization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#666666;strokeColor=#333333;strokeWidth=2;fontSize=12;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="800" y="1060" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Observability Platform -->
        <mxCell id="observability" value="Observability Platform&#xa;(AB-096)&#xa;Monitoring, Metrics, Latency" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#666666;strokeColor=#333333;strokeWidth=2;fontSize=12;fontStyle=1;fontFamily=Helvetica;fontColor=#FFFFFF;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1440" y="1060" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Cache Layer -->
        <mxCell id="cache-layer" value="Cache Layer&#xa;(Redis)&#xa;Embedding &amp; Document Cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#50E6FF;strokeColor=#333333;strokeWidth=2;fontSize=12;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="2040" y="1060" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Data Flow Arrows -->
        <!-- User Query to Intent Analyzer -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#003087;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="user-query" target="query-intent">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-label" value="1. Query" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#003087;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Intent Analyzer to Query Rewrite (optional) -->
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF6B35;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=5 5;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="query-intent" target="query-rewrite">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-label" value="2. Rewrite&#xa;(optional)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#FF6B35;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow2">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Query Rewrite to Hybrid Search -->
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#003087;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="query-rewrite" target="hybrid-search">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-label" value="3. Enhanced Query" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#003087;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow3">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Hybrid Search to Vector DB -->
        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00A651;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="hybrid-search" target="vector-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow4-label" value="4. Search&#xa;(Dense + Sparse)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#00A651;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow4">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="20" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Vector DB to Hybrid Search (Results) -->
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00A651;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="vector-db" target="hybrid-search">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="670" />
              <mxPoint x="800" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow5-label" value="5. Top-K Candidates&#xa;(e.g., top 20)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#00A651;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow5">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="20" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Hybrid Search to Reranking -->
        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#003087;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="hybrid-search" target="reranking">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow6-label" value="6. Candidates" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#003087;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow6">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Reranking to LLM -->
        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#003087;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="reranking" target="llm-generator">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow7-label" value="7. Top-N Docs&#xa;(e.g., top 5)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#003087;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow7">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- LLM to Citation Generator -->
        <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#50E6FF;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="llm-generator" target="citation-gen">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow8-label" value="8. Extract&#xa;Citations" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#50E6FF;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow8">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- LLM to Self-Critique -->
        <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF6B35;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="llm-generator" target="self-critique">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow9-label" value="9. Response for&#xa;Quality Check" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#FF6B35;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow9">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Self-Critique to Response Output -->
        <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00A651;strokeWidth=3;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="self-critique" target="response-output">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow10-label" value="10. If Quality OK" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#00A651;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow10">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Self-Critique Retry Loop -->
        <mxCell id="arrow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#CC0000;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=5 5;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="self-critique" target="hybrid-search">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1630" y="280" />
              <mxPoint x="740" y="280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow11-label" value="11. Retry if Low Quality" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#CC0000;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow11">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Document Processing to Document Store -->
        <mxCell id="arrow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="doc-processing" target="doc-store">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow12-label" value="Ingest" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#666666;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow12">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Embedding Model to Vector DB -->
        <mxCell id="arrow13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#50E6FF;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="embedding-model" target="vector-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1010" y="740" />
              <mxPoint x="900" y="740" />
              <mxPoint x="900" y="670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow13-label" value="Store&#xa;Embeddings" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#50E6FF;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow13">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="10" y="10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Document Store to Embedding Model -->
        <mxCell id="arrow14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=2;endArrow=block;endFill=1;fontSize=12;fontFamily=Helvetica;" edge="1" parent="1" source="doc-store" target="embedding-model">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="870" />
              <mxPoint x="860" y="680" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow14-label" value="Chunks" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontFamily=Helvetica;fontColor=#666666;fontStyle=1;labelBackgroundColor=#FFFFFF;" vertex="1" connectable="0" parent="arrow14">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-container" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1920" y="1200" width="360" height="340" as="geometry" />
        </mxCell>

        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1210" width="320" height="30" as="geometry" />
        </mxCell>

        <!-- Legend Items -->
        <mxCell id="legend-core" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#003087;strokeColor=#333333;strokeWidth=2;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1250" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-core-label" value="Core ABB (Critical)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1250" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-optional" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF6B35;strokeColor=#333333;strokeWidth=2;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1290" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-optional-label" value="Optional/Advanced ABB" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1290" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-support" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#50E6FF;strokeColor=#333333;strokeWidth=2;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1330" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-support-label" value="Supporting ABB" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1330" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-db" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#00A651;strokeColor=#333333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1370" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-db-label" value="Data Store (Vector DB)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1370" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-cross" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#666666;strokeColor=#333333;strokeWidth=2;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="1940" y="1410" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend-cross-label" value="Cross-Cutting ABB" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1410" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-arrow-primary" value="" style="endArrow=block;html=1;strokeColor=#003087;strokeWidth=2;endFill=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1940" y="1460" as="sourcePoint" />
            <mxPoint x="1980" y="1460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-arrow-primary-label" value="Primary Data Flow" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1445" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-arrow-optional" value="" style="endArrow=block;html=1;strokeColor=#FF6B35;strokeWidth=2;endFill=1;dashed=1;dashPattern=5 5;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1940" y="1500" as="sourcePoint" />
            <mxPoint x="1980" y="1500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-arrow-optional-label" value="Optional/Retry Flow" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1990" y="1485" width="280" height="30" as="geometry" />
        </mxCell>

        <!-- Metadata Box -->
        <mxCell id="metadata-box" value="Pattern: PT-005 Self-Reflective RAG&#xa;Version: 1.0.0 | Status: Approved&#xa;Created: 2025-12-05&#xa;Latency Target: &lt;3s (without critique), &lt;4s (with critique)&#xa;Quality Target: Precision@5 &gt;80%, Hallucination &lt;5%" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#003087;strokeWidth=2;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10;fontSize=10;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="120" y="1200" width="360" height="120" as="geometry" />
        </mxCell>

        <!-- Architecture Notes -->
        <mxCell id="notes-box" value="Key Architecture Features:&#xa;• Hybrid Search: Dense (vector) + Sparse (BM25)&#xa;• Reranking: Top-20 candidates → Top-5 final docs&#xa;• Self-Critique: Quality check with retry logic&#xa;• Citations: Source attribution for transparency&#xa;• Document-level access control enforcement" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#00A651;strokeWidth=2;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10;fontSize=10;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="1200" width="360" height="120" as="geometry" />
        </mxCell>

        <!-- Use Cases Box -->
        <mxCell id="usecases-box" value="Primary BNZ Use Cases:&#xa;• UC-001: Partnership Banking (customer data RAG)&#xa;• UC-004: Credit Risk (policy documents)&#xa;• UC-005: Lending Ops (underwriting guidelines)&#xa;• UC-007: Contact Centre (knowledge base, FAQs)&#xa;• UC-017: FrontLine CIB (research, market data)&#xa;• UC-021: Wholesale Underwriting (credit memos)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#50E6FF;strokeWidth=2;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10;fontSize=10;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="920" y="1200" width="360" height="120" as="geometry" />
        </mxCell>

        <!-- Performance Box -->
        <mxCell id="performance-box" value="Performance Benchmarks:&#xa;• Query Intent: &lt;50ms&#xa;• Hybrid Search: &lt;100ms&#xa;• Reranking: &lt;200ms&#xa;• LLM Generation: &lt;2s&#xa;• Self-Critique: &lt;500ms&#xa;• Cost: $0.011-$0.033/query" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#FF6B35;strokeWidth=2;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10;fontSize=10;fontFamily=Helvetica;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1320" y="1200" width="360" height="120" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
